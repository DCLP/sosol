#main.site
  - max_visible_pubs = 5
  = render :partial => "common/flash_all"
  %h2 Your Publications
  -# render publications without status
  = render :partial => "publications/list", :object => @publications.collect{|p| p.status.nil? ? p : nil}.compact
  - statuses = @publications.collect{|p| p.status}.uniq.compact.sort_by{|s| ["new","editing","submitted","voting","approved","finalizing","committed"].index(s) }
  - for status in statuses
    %br
    %h3== Your #{status} publications
    - this_publication_set = @publications.collect{|p| p.status == status ? p : nil}.compact
    = render :partial => "publications/list", :object => this_publication_set[0..max_visible_pubs-1]
    - if this_publication_set.length > max_visible_pubs
      %div{:id => "more_user_#{status}", :style => "display:none;"}
        = render :partial => "publications/list", :object => this_publication_set[max_visible_pubs..-1]
      %div{:id => "more_link_#{status}"}
        %a{:class => 'morelink', :href => '#', :onclick => "Effect.SlideDown('more_user_#{status}');Effect.SlideUp('more_link_#{status}');return false;"}
          More...
  %br
  = render :partial => "publications/publication_selector"
  
  - if @current_user.developer
    #developer
      %br
      - form_for :publication, Publication.new, :url => { :controller => "publications", :action => "create" } do |form|
        = label_tag 'pn_id', 'Create publication from PN ID:'
        = text_field_tag 'pn_id', '', :size => 40
        = form.submit "Create", :class => ''
  
  %br
  - form_for :publication, Publication.new, :url => { :controller => "publications", :action => "create_from_templates" } do |form|
    = "or create a new publicaiton:"
    %br
    = form.submit "Create New Publication", :class => 'save'
  %br
  - if @current_user.boards.length > 0
    %h2
      Boards
    - @current_user.boards.each do |board| 
      - finalizing_publications =  @board_final_pubs.collect{|p| p.parent.owner == board ? p : nil}.compact
      - approved_publications = board.publications.collect{|p| p.status == "approved" ? p :nil}.compact
      -#remove approved publications if in the finalizer list
      - finalizing_publications.each do |fp|
        -#remove it from the list of approved publications
        - approved_publications.each do |ap|
          - if fp.origin == ap.origin
            - approved_publications.delete(ap)
           
      %h2
        #{board.title} 
        -#= link_to board.title, :id => board.id, :controller => "boards", :action => "overview"
        Publications 
      - board_publications = board.publications.collect{|p| p.status == "voting" ? p :nil}.compact
      - if board_publications.length > 0        
        %h3== Voting Publications
        = render :partial => "publications/list", :object => board_publications
        %br
        
      -#- approved_publications = board.publications.collect{|p| p.status == "approved" ? p :nil}.compact
      - if approved_publications.length > 0        
        %h3== Approved Publications
        = render :partial => "publications/list", :object => approved_publications
        %br
        
      - board_publications = board.publications.collect{|p| p.status == "committed" ? p :nil}.compact
      - if board_publications.length > 0        
        %h3== Committed Publications
        = render :partial => "publications/list", :object => board_publications
        %br
        
      -#- finalizing_publications =  @board_final_pubs.collect{|p| p.parent.owner == board ? p : nil}.compact
      - if finalizing_publications.length > 0         
        %h3== Your Publications to Finalize
        = render :partial => "publications/list", :object => finalizing_publications
        %br
        
  %h2 News Feed
  = render :partial => "events/list", :object => @events
